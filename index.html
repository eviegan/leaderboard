<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Referral Race ‚Äî Leaderboard</title>
<style>
  :root{
    --bg:#0c0c12;--ink:#eef2ff;--muted:#a0a7c9;
    --edge:rgba(255,255,255,.08);--p1:#8b5dff;--p2:#aa74ff;
    --glow:rgba(153,120,255,.3);--acc:#ffd86a;
  }
  *{box-sizing:border-box}
  body,html{margin:0;height:100%;background:#0b0c18;color:var(--ink);
    font-family:Inter,system-ui,Segoe UI,Roboto,sans-serif;}
  .app{max-width:520px;margin:0 auto;padding-bottom:90px}
  header{position:sticky;top:0;background:#10112a;border-bottom:1px solid var(--edge);
    padding:14px;font-weight:900;font-size:18px;text-align:center;z-index:20}
  .card{background:linear-gradient(180deg,#161733,#10112a);
    border:1px solid var(--edge);border-radius:16px;padding:14px;margin:12px;}
  .rr .podiumCard{margin:12px;border-radius:22px;padding:16px 12px;
    background:linear-gradient(180deg,#f4eaff,#f9f6ff);color:#221a44;}
  .rr .podium{display:grid;grid-template-columns:1fr 1.2fr 1fr;
    gap:10px;align-items:end;text-align:center}
  .rr .step{position:relative;background:linear-gradient(180deg,#fff,#ece7ff);
    border-radius:16px;padding:10px;border:1px solid rgba(0,0,0,.06);
    box-shadow:inset 0 -12px 18px rgba(100,70,180,.1),0 8px 18px rgba(0,0,0,.1)}
  .rr .av{width:70px;height:70px;border-radius:50%;margin:0 auto;
    background:#eee center/cover no-repeat;border:3px solid #fff;box-shadow:0 5px 10px rgba(0,0,0,.2)}
  .rr .name{font-weight:800;margin-top:8px}
  .rr .scoreMini{font-size:12px;color:#6a5ca8}
  .rr .list{margin:10px 12px;display:grid;gap:8px}
  .rr .row{display:grid;grid-template-columns:40px 1fr auto;align-items:center;
    background:rgba(255,255,255,.1);border-radius:12px;padding:8px 10px}
  .rr .rk{font-weight:900;text-align:center}
  .rr .uname{font-weight:700}
  .rr .val{font-weight:900;color:#ffd86a}
  .rr .face{width:34px;height:34px;border-radius:50%;
    background:#ccc center/cover no-repeat;margin-right:8px;border:2px solid #fff}
  .rr .left{display:flex;align-items:center}
  .search{display:grid;grid-template-columns:1fr auto;gap:8px;margin:12px}
  input{border-radius:10px;border:1px solid var(--edge);
    background:#0f1030;color:#fff;padding:10px}
  button{border:0;border-radius:10px;padding:10px 14px;font-weight:900;
    cursor:pointer;background:#ffd86a;color:#3a2400;}
  /* bottom nav */
  .iconnav{position:fixed;bottom:8px;left:50%;transform:translateX(-50%);
    width:min(500px,calc(100% - 16px));display:grid;grid-template-columns:repeat(5,1fr);
    background:#111229;padding:10px;border-radius:16px;box-shadow:0 8px 18px rgba(0,0,0,.3);
    border:1px solid var(--edge);}
  .iconnav button{background:none;border:0;color:#ccc;display:flex;
    flex-direction:column;align-items:center;font-weight:700}
  .iconnav button.active{color:#fff}
</style>
</head>
<body>
<div class="app">
  <header id="hdr">Referral Race</header>
  <main id="view"></main>
</div>

<nav class="iconnav">
  <button data-tab="home" class="active">üè†<span>Home</span></button>
  <button data-tab="ranks">üèÜ<span>Ranks</span></button>
  <button data-tab="terms">üìú<span>T&amp;C</span></button>
  <button data-tab="community">üë•<span>Community</span></button>
  <button data-tab="minigame">üéÆ<span>Mini Game</span></button>
</nav>

<!-- Firebase + Firestore -->
<script type="module">
  const firebaseConfig = {
    apiKey: "AIzaSyABCZr2auIlT3ipJBGLJpHJi_CsQNQ0RQc",
    authDomain: "referral-race.firebaseapp.com",
    projectId: "referral-race",
    storageBucket: "referral-race.firebasestorage.app",
    messagingSenderId: "866066081377",
    appId: "1:866066081377:web:c5945830784f19e9af2c20"
  };
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const view=document.getElementById('view');
  const hdr=document.getElementById('hdr');
  let state={tab:'home'};
  const navBtns=document.querySelectorAll('.iconnav button');
  navBtns.forEach(btn=>btn.onclick=()=>{
    navBtns.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    state.tab=btn.dataset.tab; render();
  });

  function face(url){return url?`url(${url})`:`url(data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='32' cy='26' r='14' fill='%23fff'/><rect x='16' y='42' width='32' height='16' rx='8' fill='%23fff'/></svg>)`}

  async function loadLeaderboard(){
    const tenant=new URL(location).searchParams.get('tenant');
    const board=new URL(location).searchParams.get('board')||'current';
    if(!tenant)return [];
    const snap=await getDocs(query(collection(db,'tenants',tenant,'leaderboards',board,'entries'),orderBy('points','desc')));
    return snap.docs.map(d=>d.data());
  }

  async function renderRanks(){
    hdr.textContent="Referral Ranking";
    view.innerHTML=`<div class='rr'>
      <div class='podiumCard'>
        <div class='podium'>
          <div class='step'><div class='av' id='p2'></div><div class='name' id='n2'>-</div><div class='scoreMini' id='s2'></div></div>
          <div class='step'><div class='av' id='p1'></div><div class='name' id='n1'>-</div><div class='scoreMini' id='s1'></div></div>
          <div class='step'><div class='av' id='p3'></div><div class='name' id='n3'>-</div><div class='scoreMini' id='s3'></div></div>
        </div>
      </div>
      <div class='list' id='list'></div>
      <div class='search'><input id='q' placeholder='Search username...'><button id='find'>Find</button></div>
      <div id='mine'></div>
    </div>`;
    const data=await loadLeaderboard();
    if(!data.length){view.innerHTML+="<p style='text-align:center;opacity:.6'>No data yet</p>";return;}
    data.sort((a,b)=>b.points-a.points);
    const top=data.slice(0,3);
    [1,2,3].forEach(i=>{
      const r=top[i-1];
      if(!r)return;
      document.getElementById('p'+i).style.backgroundImage=face(r.avatar);
      document.getElementById('n'+i).textContent=r.username;
      document.getElementById('s'+i).textContent=r.points+" pts";
    });
    const list=document.getElementById('list');
    data.forEach((r,i)=>{
      if(i<3)return;
      const div=document.createElement('div');
      div.className='row';
      div.innerHTML=`<div class='rk'>${i+1}</div>
        <div class='left'><div class='face' style='background-image:${face(r.avatar)}'></div>
        <div class='uname'>${r.username}</div></div>
        <div class='val'>${r.points}</div>`;
      list.append(div);
    });
    document.getElementById('find').onclick=()=>{
      const q=document.getElementById('q').value.trim().toLowerCase();
      const me=data.find(x=>x.username.toLowerCase()===q);
      const mine=document.getElementById('mine');
      if(me)mine.innerHTML=`‚≠ê ${me.username}: ${me.points} pts (Rank ${data.indexOf(me)+1})`;
      else mine.innerHTML='No match found';
    };
  }

  function renderHome(){
    hdr.textContent="Referral Race";
    view.innerHTML=`<div class='card'><h2>Welcome!</h2><p>Invite friends to join Rico.bet and climb the leaderboard to win prizes every week!</p></div>`;
  }
  function renderTerms(){
    hdr.textContent="Terms & Conditions";
    view.innerHTML=`<div class='card'><h2>Rules</h2><ul><li>1 point per verified signup</li><li>Top winners every Monday</li><li>Fraudulent referrals are disqualified</li></ul></div>`;
  }
  function renderCommunity(){
    hdr.textContent="Community";
    view.innerHTML=`<div class='card'><p>Follow our channels for news and bonus drops:</p>
      <p>üì¢ Telegram ‚Ä¢ üé∞ Instagram ‚Ä¢ üíé Discord</p></div>`;
  }
  function renderMiniGame(){
    hdr.textContent="Mini Game";
    view.innerHTML=`<div class='card'><h2>Coming Soon</h2><p>Mini games to earn bonus points!</p></div>`;
  }

  function render(){
    if(state.tab==='ranks')renderRanks();
    else if(state.tab==='terms')renderTerms();
    else if(state.tab==='community')renderCommunity();
    else if(state.tab==='minigame')renderMiniGame();
    else renderHome();
  }
  render();
</script>
</body>
</html>
